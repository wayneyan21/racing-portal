<!doctype html>
<html lang="zh-HK">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>賽事詳情 - HKJC 面板</title>
<style>
  :root{
    --bg: #0f1115;
    --panel: #171a21;
    --muted: #9aa4b2;
    --text: #e6ebf2;
    --primary: #4da3ff;
    --accent: #7ee081;
    --danger: #ff6b6b;
    --border: #2a2f3a;
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg: #f6f7fb; --panel:#fff; --muted:#5e6a77; --text:#1b2430;
      --primary:#1864ff; --accent:#129b45; --danger:#c42525; --border:#e7eaf0;
    }
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto}

  .appbar{position:sticky;top:0;z-index:40;background:var(--panel);border-bottom:1px solid var(--border)}
  .appbar .row{display:flex;align-items:center;gap:.75rem;padding:.6rem 1rem}
  .btn{border:1px solid var(--border);background:transparent;color:var(--text);padding:.4rem .7rem;border-radius:.55rem;cursor:pointer}
  .btn.primary{background:var(--primary);border-color:transparent;color:#fff}
  .muted{color:var(--muted)}

  main{padding:1rem}
  .tabs{display:flex;gap:.25rem;border-bottom:1px solid var(--border);padding:.2rem}
  .tab{padding:.55rem .9rem;border-radius:.55rem;cursor:pointer;color:var(--muted)}
  .tab.active{background:rgba(77,163,255,.15);color:var(--text)}
  .panel{display:none;padding:1rem 0}
  .panel.active{display:block}

  .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:.8rem}
  .card{border:1px solid var(--border);border-radius:.65rem;padding:.9rem;background:var(--panel)}
  .kv{display:grid;grid-template-columns:120px 1fr;gap:.35rem .6rem}
  .kv div{padding:.15rem 0;border-bottom:1px dashed var(--border)}

  .table-wrap{background:var(--panel);border:1px solid var(--border);border-radius:.8rem;overflow:hidden}
  .table{width:100%;border-collapse:collapse}
  .table th,.table td{border-bottom:1px solid var(--border);padding:.55rem .4rem;text-align:left}
  .table th{color:var(--muted);font-weight:600}

  @media (max-width:600px){
    .kv{grid-template-columns:1fr}
  }
</style>
</head>
<body>
<div class="appbar">
  <div class="row">
    <button class="btn" id="btnBack">← 返回賽日</button>
    <div>
      <div id="title-main"><strong>賽事詳情</strong></div>
      <div class="muted" id="title-sub"></div>
    </div>
    <div style="flex:1"></div>
    <button class="btn primary" id="btnReload">重新載入</button>
  </div>
</div>

<main>
  <div class="tabs" id="tabs">
    <div class="tab active" data-tab="basic">基本資料</div>
    <div class="tab" data-tab="odds">賠率 / 投注池</div>
    <div class="tab" data-tab="runners">馬匹名單</div>
  </div>

  <section class="panel active" id="panel-basic">
    <div class="cards" id="basicCards"></div>
  </section>

  <section class="panel" id="panel-odds">
    <div class="table-wrap">
      <table class="table" id="oddsTable">
        <thead><tr>
          <th>馬號</th><th>馬名</th><th>獨贏</th><th>位置</th><th class="muted">更新</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>
    <p class="muted" style="margin-top:.5rem;">（示例數據；接駁你爬蟲/JSON 後自動更新）</p>
  </section>

  <section class="panel" id="panel-runners">
    <div class="table-wrap">
      <table class="table" id="runnersTable">
        <thead><tr>
          <th>馬號</th><th>馬名（中/英）</th><th>評分</th><th>騎師</th><th>練馬師</th><th>檔位</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>
</main>

<script>
// 1. 讀 URL 參數
const params = new URLSearchParams(window.location.search);
const raceDate = params.get('date') || new Date().toISOString().slice(0,10);
const venue    = params.get('venue') || 'ST';
const raceNo   = Number(params.get('race') || '1');

// 2. Demo 賽事 + 馬匹（之後可換成真正 API）
const demoRace = (no) => ({
  no,
  time: ["12:45","13:15","13:50","14:20","14:50","15:20","15:55","16:25","17:00","17:35","18:05","18:40"][no-1],
  course: (no%2? "草地":"全天候"),
  distance: (no%2? 1200:1650),
  going: "好",
  status: "預定",
  runners: Array.from({length: 14}, (_,i)=>({
    draw: i+1,
    num: (i+1),
    name_zh: `示例馬${i+1}`,
    name_en: `Demo Horse ${i+1}`,
    rating: 60 + ((i*3)%20),
    jockey: `騎師${(i%6)+1}`,
    trainer: `練馬師${(i%5)+1}`,
    win: (3.2 + (Math.random()*10)).toFixed(1),
    pla: (1.6 + (Math.random()*6)).toFixed(1),
    updated_at: new Date().toLocaleTimeString()
  }))
});

const state = {
  race: demoRace(raceNo),
  tab: 'basic'
};

// 3. 標題
document.getElementById('title-main').innerHTML =
  `<strong>第 ${state.race.no} 場</strong>`;
document.getElementById('title-sub').textContent =
  `${raceDate}・${venue}・${state.race.course} ${state.race.distance}m`;

// 4. 返回按鈕
document.getElementById('btnBack').onclick = () => {
  // 優先用 history 返回；如果冇就回 index.html
  if (window.history.length > 1) {
    window.history.back();
  } else {
    const url = new URL(window.location.origin + '/index.html');
    url.searchParams.set('date', raceDate);
    url.searchParams.set('venue', venue);
    window.location.href = url.toString();
  }
};

// 5. 重新載入（之後可改成真正 fetch API）
document.getElementById('btnReload').onclick = () => {
  state.race = demoRace(raceNo);   // demo 重新生成 random 賠率
  renderCurrentTab();
};

// 6. Tabs 控制
const panels = {
  basic: document.getElementById('panel-basic'),
  odds: document.getElementById('panel-odds'),
  runners: document.getElementById('panel-runners')
};
document.getElementById('tabs').addEventListener('click', (e)=>{
  const t = e.target.closest('.tab'); if(!t) return;
  state.tab = t.dataset.tab;
  renderTabs();
  renderCurrentTab();
});
function renderTabs(){
  [...document.getElementById('tabs').children].forEach(t =>
    t.classList.toggle('active', t.dataset.tab===state.tab)
  );
  Object.keys(panels).forEach(k =>
    panels[k].classList.toggle('active', k===state.tab)
  );
}

// 7. 各 panel render
function renderBasic(){
  const r = state.race;
  const box = document.getElementById('basicCards');
  box.innerHTML = `
    <div class="card">
      <h3 style="margin:.2rem 0 .6rem">第 ${r.no} 場</h3>
      <div class="kv">
        <div class="muted">賽日</div><div>${raceDate}</div>
        <div class="muted">場地</div><div>${venue}</div>
        <div class="muted">開跑時間</div><div>${r.time}</div>
        <div class="muted">途程</div><div>${r.course} ${r.distance} m</div>
        <div class="muted">場地狀況</div><div>${r.going}</div>
        <div class="muted">狀態</div><div>${r.status}</div>
        <div class="muted">參賽數</div><div>${r.runners.length}</div>
      </div>
    </div>
    <div class="card">
      <h4 style="margin:.2rem 0 .4rem">備註</h4>
      <p class="muted">（連接你的爬蟲後，可在此顯示賽事通告、抽籤、換騎、退賽等）</p>
    </div>`;
}
function renderOdds(){
  const r = state.race;
  const tbody = document.querySelector('#oddsTable tbody');
  tbody.innerHTML = r.runners.map(h=>`
    <tr><td>${h.num}</td><td>${h.name_zh}</td><td>${h.win}</td><td>${h.pla}</td><td class="muted">${h.updated_at}</td></tr>`
  ).join('');
}
function renderRunners(){
  const r = state.race;
  const tbody = document.querySelector('#runnersTable tbody');
  tbody.innerHTML = r.runners.map(h=>`
    <tr><td>${h.num}</td><td>${h.name_zh} <span class="muted">/ ${h.name_en}</span></td><td>${h.rating}</td><td>${h.jockey}</td><td>${h.trainer}</td><td>${h.draw}</td></tr>`
  ).join('');
}
function renderCurrentTab(){
  if (state.tab==='basic')   renderBasic();
  if (state.tab==='odds')    renderOdds();
  if (state.tab==='runners') renderRunners();
}

// 8. 初始 render
renderTabs();
renderCurrentTab();
</script>
</body>
</html>
